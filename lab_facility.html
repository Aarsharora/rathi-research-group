<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>lab facility || Rathi Lab</title>
    <link rel="Icon" type="image/x-icon" href="assets/img/favicon.ico">
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/lab_facility.css">
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="assets/css/animations.css">
</head>

<body>
    <div class="navigation">
        <nav class="navbar navbar-expand-lg">
            <div class="container">
                <a class="navbar-brand" href="index.html"><img
                        src="assets/img/Screenshot_2025-11-12_131002-removebg-preview.png" class="img-fluid"
                        style="width: 90px;" alt="">R.R.G</a>

                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
                    <ul class="navbar-nav">
                        <li class="nav-item">
                            <a class="nav-link" href="about.html">About</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="research.html">Research</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="news.html">News</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="collabration.html">Collaboration</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="publication.html">Publication</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="team.html">Team</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="lab_facility.html">Lab Facility</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="gallry.html">Gallery</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="contact.html">Contact</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </div>
    <div class="breadcrumb-section">
        <div class="breadcrumb-container">
            <nav class="breadcrumb-nav" aria-label="Breadcrumb">
                <a href="index.html" class="breadcrumb-item">
                    <svg class="home-icon" fill="currentColor" viewBox="0 0 20 20">
                        <path
                            d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z" />
                    </svg>
                    Home
                </a>
                <span class="breadcrumb-separator">›</span>
                <a href="lab_facility.html" class="breadcrumb-item">
                    Lab Facility
                </a>
            </nav>
            <h1 class="page-title text-center">Lab Facility</h1>
            <p class="page-description text-center">Explore our state-of-the-art laboratory facilities equipped with
                cutting-edge equipment and technology. Our lab provides an ideal environment for innovative research and
                scientific discovery.</p>
        </div>
    </div>

    <div class="facility-main-container" id="facilityContainer">
        <!-- Dynamic facility cards will load here -->
    </div>

    <footer class="footer-section">
        <div class="footer-content">
            <!-- Logo -->
            <div class="logo-container">
                <img class="logo-icon" src="assets/img/second logo 1.png">
                </img>
                <div class="logo-text">Rathi Lab</div>
            </div>

            <!-- Navigation Menu -->
            <ul class="nav-menu">
                <li><a href="index.html">Home</a></li>
                <li><a href="research.html">Research</a></li>
                <li><a href="publication.html">Publications</a></li>
                <li><a href="team.html">Team</a></li>
                <li><a href="gallry.html">Gallery</a></li>
                <li><a href="contact.html">Contact</a></li>
            </ul>

            <!-- Email Icon -->
            <div class="email-icon">
                <a href="mailto:rathi@mit.edu" title="Email Us">
                    <i class="fas fa-envelope"></i>
                </a>
            </div>

            <!-- Bottom Section -->
            <div class="footer-bottom">
                <!-- MIT Logo -->
                <!-- Copyright -->
                <div class="copyright">
                    © 2025 <strong>Rathi Research Group</strong>. All rights reserved.
                    Proudly created by <strong><a href="https://arsharora.netlify.app/"
                            style="text-decoration: none; color: inherit;">Arsh Arora</strong></a>.
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script src="assets/js/Main.js"></script>
    <script>
        // ============ Lab Facility API Rendering ============
        document.addEventListener('DOMContentLoaded', () => {
            const ENDPOINTS = [
                'https://lab-backend-awux.onrender.com/api/lab-facilities',
                'https://lab-backend-awux.onrender.com/lab-facilities',
                'https://lab-backend-awux.onrender.com/api/labfacilities',
                'https://lab-backend-awux.onrender.com/labfacilities',
                'https://lab-backend-awux.onrender.com/api/lab-facility',
                'https://lab-backend-awux.onrender.com/lab-facility'
            ];

            const container = document.getElementById('facilityContainer');

            function buildImageUrl(imagePath) {
                // Gray placeholder SVG data URI
                const PLACEHOLDER_IMAGE = 'data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'900\' height=\'550\' viewBox=\'0 0 900 550\'%3E%3Crect width=\'900\' height=\'550\' fill=\'%23e2e8f0\'/%3E%3Ctext x=\'50%25\' y=\'50%25\' font-family=\'Arial, sans-serif\' font-size=\'30\' fill=\'%2364748b\' dy=\'.3em\' text-anchor=\'middle\'%3ENo Image%3C/text%3E%3C/svg%3E';

                if (!imagePath) return PLACEHOLDER_IMAGE;
                let trimmed = String(imagePath).trim();

                // If local asset, or full URL, or data URI -> return as is
                if (trimmed.startsWith('assets/') || /^(https?:)?\/\//i.test(trimmed) || trimmed.startsWith('data:')) {
                    return trimmed;
                }

                // Replace localhost with remote URL if present
                if (trimmed.includes('localhost:3000')) {
                    trimmed = trimmed.replace(/http:\/\/localhost:3000\/?/g, 'https://lab-backend-awux.onrender.com/');
                }

                const normalized = trimmed.replace(/\\/g, '/').replace(/^\/+/, '');
                return `https://lab-backend-awux.onrender.com/${normalized}`;
            }

            function extractArray(data) {
                if (Array.isArray(data)) return data;

                // Common named keys
                if (data && Array.isArray(data.data)) return data.data;
                if (data && Array.isArray(data.facilities)) return data.facilities;
                if (data && Array.isArray(data.labFacilities)) return data.labFacilities;
                if (data && Array.isArray(data.lab_facilities)) return data.lab_facilities;
                if (data && Array.isArray(data.items)) return data.items;
                if (data && Array.isArray(data.results)) return data.results;

                // Dynamic search: find ANY key that is an array
                if (data && typeof data === 'object') {
                    for (const key in data) {
                        if (Array.isArray(data[key])) {
                            console.log(`Found array in key: ${key}`);
                            return data[key];
                        }
                    }
                }

                return [];
            }

            function renderFacilities(items) {
                if (!container) {
                    console.error('facilityContainer element not found!');
                    return;
                }
                container.innerHTML = '';

                if (!items || items.length === 0) {
                    container.innerHTML = '<p class="text-center text-muted py-5">No facilities available.</p>';
                    return;
                }

                console.log(`Rendering ${items.length} facilities`);

                // Gray placeholder SVG data URI for onerror
                const PLACEHOLDER_IMAGE = 'data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'900\' height=\'550\' viewBox=\'0 0 900 550\'%3E%3Crect width=\'900\' height=\'550\' fill=\'%23e2e8f0\'/%3E%3Ctext x=\'50%25\' y=\'50%25\' font-family=\'Arial, sans-serif\' font-size=\'30\' fill=\'%2364748b\' dy=\'.3em\' text-anchor=\'middle\'%3ENo Image%3C/text%3E%3C/svg%3E';

                const sections = items.map((item, idx) => `
                    <div class="facility-section animate">
                        <div class="facility-item-wrapper">
                            <div class="facility-image-box">
                                <img src="${buildImageUrl(item.imageUrl)}" alt="${item.title || 'Facility image'}"
                                     onerror="this.src='${PLACEHOLDER_IMAGE}'">
                            </div>
                            <div class="facility-text-content">
                                <h3>${item.title || 'Untitled'}</h3>
                                <p>${item.content || ''}</p>
                            </div>
                        </div>
                    </div>
                `).join('');

                container.innerHTML = sections;
            }

            const FALLBACK_DATA = [
                {
                    _id: '1',
                    title: 'Advanced Microscopy Suite',
                    content: 'Our lab is equipped with state-of-the-art confocal and fluorescence microscopes for high-resolution imaging of cellular processes and protein localization.',
                    imageUrl: 'assets/img/slider%20photos/IMG_3611.JPG'
                },
                {
                    _id: '2',
                    title: 'Protein Purification System',
                    content: 'We utilize automated FPLC and HPLC systems for the purification and characterization of proteins and macromolecular complexes.',
                    imageUrl: 'assets/img/slider%20photos/IMG_3633.JPG'
                },
                {
                    _id: '3',
                    title: 'Cell Culture Facility',
                    content: 'Our dedicated cell culture room provides a sterile environment for mammalian cell line maintenance, transfection, and assay development.',
                    imageUrl: 'assets/img/slider%20photos/IMG_3640.JPG'
                },
                {
                    _id: '4',
                    title: 'Biophysical Characterization',
                    content: 'Instruments for circular dichroism (CD), dynamic light scattering (DLS), and isothermal titration calorimetry (ITC) allow us to study protein folding and interactions in detail.',
                    imageUrl: 'assets/img/slider%20photos/IMG_3646.JPG'
                }
            ];

            async function loadFacilities() {
                if (container) {
                    container.innerHTML = '<p class="text-center text-muted py-5">Loading facilities...</p>';
                }

                console.log("Using demo facilities data");
                const items = FALLBACK_DATA;

                renderFacilities(items);
            }

            loadFacilities();
        });

        // ============================================
        // Sticky Navigation on Scroll
        // ============================================
        window.addEventListener('scroll', function () {
            const navigation = document.querySelector('.navigation');

            if (window.scrollY > 200) {
                navigation.classList.add('sticky');
                document.body.style.paddingTop = navigation.offsetHeight + 'px';
            } else {
                navigation.classList.remove('sticky');
                document.body.style.paddingTop = '0';
            }
        });

        // ============================================
        // Active Page Highlight
        // ============================================
        document.addEventListener('DOMContentLoaded', function () {
            const currentPage = window.location.pathname.split('/').pop();
            const navLinks = document.querySelectorAll('.nav-link');

            navLinks.forEach(link => {
                if (link.getAttribute('href') === currentPage) {
                    link.classList.add('active');
                }
            });
        });

        // ============================================
        // Close Mobile Menu on Link Click
        // ============================================
        document.addEventListener('DOMContentLoaded', function () {
            const navLinks = document.querySelectorAll('.nav-link');
            const navbarCollapse = document.querySelector('.navbar-collapse');

            navLinks.forEach(link => {
                link.addEventListener('click', function () {
                    if (navbarCollapse.classList.contains('show')) {
                        const bsCollapse = new bootstrap.Collapse(navbarCollapse, {
                            toggle: false
                        });
                        bsCollapse.hide();
                    }
                });
            });
        });

        // ============================================
        // Scroll Animation with Intersection Observer
        // ============================================
        document.addEventListener('DOMContentLoaded', function () {
            // Animation observer options
            const observerOptions = {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            };

            // Create intersection observer
            const observer = new IntersectionObserver(function (entries) {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('animate');
                        // For grid items, add staggered delay
                        if (entry.target.classList.contains('facility-grid-item')) {
                            const items = Array.from(document.querySelectorAll('.facility-grid-item'));
                            const index = items.indexOf(entry.target);
                            entry.target.style.transitionDelay = `${index * 0.1}s`;
                        }
                    }
                });
            }, observerOptions);

            // Observe facility sections
            const sections = document.querySelectorAll('.facility-section');
            sections.forEach((section, index) => {
                // Add initial delay for first section
                if (index === 0) {
                    section.style.animationDelay = '0.2s';
                } else {
                    section.style.animationDelay = `${index * 0.2}s`;
                }
                observer.observe(section);
            });

            // Observe facility item wrappers
            const itemWrappers = document.querySelectorAll('.facility-item-wrapper');
            itemWrappers.forEach(wrapper => {
                observer.observe(wrapper);

                // Observe image and text content separately
                const imageBox = wrapper.querySelector('.facility-image-box');
                const textContent = wrapper.querySelector('.facility-text-content');

                if (imageBox) {
                    observer.observe(imageBox);
                }
                if (textContent) {
                    observer.observe(textContent);
                }
            });

            // Observe section titles
            const sectionTitles = document.querySelectorAll('.facility-section-title');
            sectionTitles.forEach(title => {
                observer.observe(title);
            });

            // Observe grid items
            const gridItems = document.querySelectorAll('.facility-grid-item');
            gridItems.forEach((item, index) => {
                item.style.transitionDelay = `${index * 0.15}s`;
                observer.observe(item);
            });

            // Initial animation for first section
            setTimeout(() => {
                const firstSection = document.querySelector('.facility-section');
                if (firstSection) {
                    firstSection.classList.add('animate');
                }
            }, 100);
        });

    </script>
    <script src="assets/js/animations.js"></script>
</body>

</html>