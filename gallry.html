<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gallary || Rarhi Lab</title>
    <link rel="Icon" type="image/x-icon" href="assets/img/favicon.ico">
    <link rel="stylesheet" href="assets/css/gallary.css">
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="assets/css/animations.css">
</head>

<body>
    <!-- Navigation -->
    <div class="navigation">
        <nav class="navbar navbar-expand-lg">
            <div class="container">
                <a class="navbar-brand" href="index.html"><img
                        src="assets/img/Screenshot_2025-11-12_131002-removebg-preview.png" class="img-fluid"
                        style="width: 90px;" alt="">R.R.G</a>

                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
                    <ul class="navbar-nav">
                        <li class="nav-item">
                            <a class="nav-link" href="about.html">About</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="research.html">Research</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="news.html">News</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="collabration.html">Collaboration</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="publication.html">Publication</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="team.html">Team</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="lab_facility.html">Lab Facility</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="gallry.html">Gallery</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="contact.html">Contact</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </div>
    <div class="breadcrumb-section">
        <div class="breadcrumb-container">
            <nav class="breadcrumb-nav" aria-label="Breadcrumb">
                <a href="index.html" class="breadcrumb-item">
                    <svg class="home-icon" fill="currentColor" viewBox="0 0 20 20">
                        <path
                            d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z" />
                    </svg>
                    Home
                </a>

                <span class="breadcrumb-separator">›</span>

                <a href="gallry.html" class="breadcrumb-item">
                    Gallery
                </a>
            </nav>

            <h1 class="page-title text-center">Gallery</h1>
            <p class="page-description text-center">Explore our visual collection showcasing moments from events,
                projects, fieldwork, and research activities. This gallery highlights our achievements, collaborations,
                and milestones through photographs and media that capture the essence of our journey.</p>
        </div>
    </div>
    <div class="gallery-container">
        <!-- Filter Buttons -->
        <div class="filter-buttons">
            <button class="filter-btn active" onclick="filterGallery('all')">All</button>
            <button class="filter-btn" onclick="filterGallery('lab')">Lab Work</button>
            <button class="filter-btn" onclick="filterGallery('events')">Events</button>
            <button class="filter-btn" onclick="filterGallery('team')">Team</button>
            <button class="filter-btn" onclick="filterGallery('equipment')">Equipment</button>
        </div>

        <!-- Gallery Grid -->
        <div class="gallery-grid" id="galleryGrid">
            <!-- Gallery items will be populated by JavaScript -->
        </div>
    </div>

    <!-- Modal/Lightbox -->
    <div class="modal" id="modal">
        <div class="close-modal" onclick="closeModal()">×</div>
        <div class="nav-arrow prev" onclick="navigateImage(-1)">‹</div>
        <div class="nav-arrow next" onclick="navigateImage(1)">›</div>
        <div class="modal-content" id="modalContent"></div>
    </div>

    <div class="scroll-top" id="scrollTopBtn">
        <i class="fas fa-chevron-up"></i>
    </div>

    <footer class="footer-section">
        <div class="footer-content">
            <!-- Logo -->
            <div class="logo-container">
                <img class="logo-icon" src="assets/img/second logo 1.png">

                </img>
                <div class="logo-text">Rathi Research Group</div>
            </div>

            <!-- Navigation Menu -->
            <ul class="nav-menu">
                <li><a href="index.html">Home</a></li>
                <li><a href="research.html">Research</a></li>
                <li><a href="publication.html">Publications</a></li>
                <li><a href="team.html">Team</a></li>
                <li><a href="gallry.html">Gallary</a></li>
                <li><a href="contact.html">Contact</a></li>
            </ul>

            <!-- Email Icon -->
            <div class="email-icon">
                <a href="mailto:rathi@mit.edu" title="Email Us">
                    <i class="fas fa-envelope"></i>
                </a>
            </div>

            <!-- Bottom Section -->
            <div class="footer-bottom">
                <!-- MIT Logo -->
                <!-- Copyright -->
                <div class="copyright">
                    © 2025 <strong>Rathi Research Group</strong>. All rights reserved.
                    Proudly created by <strong><a href="https://arsharora.netlify.app/"
                            style="text-decoration: none; color: inherit;">Arsh Arora</strong></a>.
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script src="assets/js/Main.js"></script>

    <script>
        // ==============================
        // Gallery API Integration
        // ==============================

        const GALLERY_API_BASE = 'https://lab-backend-awux.onrender.com';
        const GALLERY_ENDPOINTS = ['/gallery', '/api/gallery'];

        let galleryData = [];
        let currentFilter = 'all';
        let currentImageIndex = 0;
        let filteredImages = [];

        function buildImageUrl(imagePath) {
            const placeholder = 'https://via.placeholder.com/800x600?text=No+Image';
            if (!imagePath) return placeholder;
            let trimmed = String(imagePath).trim();

            // Replace localhost with remote URL if present
            if (trimmed.includes('localhost:3000')) {
                trimmed = trimmed.replace(/http:\/\/localhost:3000\/?/g, GALLERY_API_BASE + '/');
            }

            if (/^(https?:)?\/\//i.test(trimmed) || trimmed.startsWith('data:')) return trimmed;
            const normalized = trimmed.replace(/\\/g, '/').replace(/^\/+/, '');
            return `${GALLERY_API_BASE}/${normalized}`;
        }

        async function loadGalleryFromApi() {
            const grid = document.getElementById('galleryGrid');

            grid.innerHTML = `
                <div class="gallery-loading">
                    <p>Loading gallery...</p>
                </div>
            `;

            let lastError = null;

            for (const endpoint of GALLERY_ENDPOINTS) {
                try {
                    const url = `${GALLERY_API_BASE}${endpoint}`;
                    console.log('Trying gallery endpoint:', url);

                    const res = await fetch(url);

                    if (!res.ok) {
                        lastError = new Error(`HTTP ${res.status} ${res.statusText}`);
                        continue;
                    }

                    const data = await res.json();
                    console.log('Gallery API raw data:', data);

                    let items = [];

                    if (Array.isArray(data)) {
                        items = data;
                    } else if (data && typeof data === 'object') {
                        if (Array.isArray(data.data)) items = data.data;
                        else if (Array.isArray(data.gallery)) items = data.gallery;
                        else if (Array.isArray(data.items)) items = data.items;
                        else if (Array.isArray(data.result)) items = data.result;
                    }

                    if (!Array.isArray(items) || items.length === 0) {
                        throw new Error('Gallery API returned no items');
                    }

                    // Normalize items to match our UI structure
                    galleryData = items.map((item, index) => ({
                        id: item.id || item._id || index + 1,
                        category: item.category || 'lab',
                        image: buildImageUrl(item.imageUrl || item.image || item.url),
                        title: item.title || 'Untitled Image',
                        description: item.description || item.caption || 'No description available.'
                    }));

                    filteredImages = [...galleryData];
                    renderGallery(filteredImages);
                    return;
                } catch (err) {
                    console.error('Gallery API error for endpoint', endpoint, err);
                    lastError = err;
                }
            }

            // If we reach here, all endpoints failed
            const errorMessage = lastError ? lastError.message : 'Unknown error';
            grid.innerHTML = `
                <div class="gallery-error">
                    <p>Failed to load gallery from API.</p>
                    <p style="font-size: 0.9rem; color: #888;">Error: ${errorMessage}</p>
                    <p style="font-size: 0.85rem; color: #aaa;">
                        Please check that the gallery API is running on <strong>${GALLERY_API_BASE}</strong>
                        and that it exposes <code>/gallery</code> or <code>/api/gallery</code> endpoints.
                    </p>
                </div>
            `;
        }

        // Render gallery items
        function renderGallery(items) {
            const grid = document.getElementById('galleryGrid');

            if (!items || items.length === 0) {
                grid.innerHTML = `
                    <div class="gallery-empty">
                        <p>No images available in the gallery.</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = items.map((item, index) => `
                <div class="gallery-item" data-category="${item.category}" onclick="openModal(${index})">
                    <span class="gallery-category">
                        ${item.category
                    ? item.category.charAt(0).toUpperCase() + item.category.slice(1)
                    : 'Gallery'}
                    </span>
                    <img src="${item.image}" alt="${item.title}" class="gallery-image"
                         onerror="this.src='https://via.placeholder.com/800x500?text=Image+Not+Available'">
                    <div class="gallery-overlay">
                        <div class="gallery-title">${item.title}</div>
                        <div class="gallery-description">${item.description}</div>
                    </div>
                </div>
            `).join('');
        }

        // Filter gallery
        function filterGallery(category) {
            currentFilter = category;

            // Update active button
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            // Use currentTarget for safer event handling
            if (window.event && window.event.currentTarget) {
                window.event.currentTarget.classList.add('active');
            }

            // Filter items
            if (category === 'all') {
                filteredImages = [...galleryData];
            } else {
                filteredImages = galleryData.filter(item => item.category === category);
            }

            renderGallery(filteredImages);
        }

        // Open modal
        function openModal(index) {
            currentImageIndex = index;
            const item = filteredImages[index];
            const modal = document.getElementById('modal');
            const modalContent = document.getElementById('modalContent');

            modalContent.innerHTML = `
                <img src="${item.image}" alt="${item.title}" class="modal-image">
                <div class="modal-info">
                    <h3>${item.title}</h3>
                    <p>${item.description}</p>
                </div>
            `;

            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        // Close modal
        function closeModal() {
            const modal = document.getElementById('modal');
            modal.classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        // Navigate images
        function navigateImage(direction) {
            currentImageIndex += direction;

            if (currentImageIndex < 0) {
                currentImageIndex = filteredImages.length - 1;
            } else if (currentImageIndex >= filteredImages.length) {
                currentImageIndex = 0;
            }

            const item = filteredImages[currentImageIndex];
            const modalContent = document.getElementById('modalContent');

            modalContent.innerHTML = `
                <img src="${item.image}" alt="${item.title}" class="modal-image">
                <div class="modal-info">
                    <h3>${item.title}</h3>
                    <p>${item.description}</p>
                </div>
            `;
        }

        // Close modal on ESC key
        document.addEventListener('keydown', function (e) {
            if (e.key === 'Escape') {
                closeModal();
            } else if (e.key === 'ArrowLeft') {
                navigateImage(-1);
            } else if (e.key === 'ArrowRight') {
                navigateImage(1);
            }
        });

        // Close modal on background click
        document.getElementById('modal').addEventListener('click', function (e) {
            if (e.target === this) {
                closeModal();
            }
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadGalleryFromApi();
        });
    </script>
    <script>
        // ============================================
        // Sticky Navigation on Scroll
        // ============================================
        window.addEventListener('scroll', function () {
            const navigation = document.querySelector('.navigation');

            if (window.scrollY > 200) {
                navigation.classList.add('sticky');
                document.body.style.paddingTop = navigation.offsetHeight + 'px';
            } else {
                navigation.classList.remove('sticky');
                document.body.style.paddingTop = '0';
            }
        });

        // ============================================
        // Active Page Highlight
        // ============================================
        document.addEventListener('DOMContentLoaded', function () {
            const currentPage = window.location.pathname.split('/').pop();
            const navLinks = document.querySelectorAll('.nav-link');

            navLinks.forEach(link => {
                if (link.getAttribute('href') === currentPage) {
                    link.classList.add('active');
                }
            });
        });

        // ============================================
        // Close Mobile Menu on Link Click
        // ============================================
        document.addEventListener('DOMContentLoaded', function () {
            const navLinks = document.querySelectorAll('.nav-link');
            const navbarCollapse = document.querySelector('.navbar-collapse');

            navLinks.forEach(link => {
                link.addEventListener('click', function () {
                    if (navbarCollapse.classList.contains('show')) {
                        const bsCollapse = new bootstrap.Collapse(navbarCollapse, {
                            toggle: false
                        });
                        bsCollapse.hide();
                    }
                });
            });
        });

    </script>
    <script src="assets/js/animations.js"></script>
</body>

</html>