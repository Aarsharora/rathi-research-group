<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Publication || Rathi Lab</title>
    <link rel="Icon" type="image/x-icon" href="assets/img/favicon.ico">
    <link rel="stylesheet" href="assets/css/publication.css">
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/style.css">

</head>

<body>
    <!-- Navigation -->
    <div class="navigation">
        <nav class="navbar navbar-expand-lg">
            <div class="container">
                <a class="navbar-brand" href="index.html"><img
                        src="assets/img/Screenshot_2025-11-12_131002-removebg-preview.png" class="img-fluid"
                        style="width: 90px;" alt="">R.R.G</a>

                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
                    <ul class="navbar-nav">
                        <li class="nav-item">
                            <a class="nav-link" href="about.html">About</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="research.html">Research</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="news.html">News</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="collabration.html">Collaboration</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="publication.html">Publication</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="team.html">Team</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="lab_facility.html">Lab Facility</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="gallry.html">Gallery</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="contact.html">Contact</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </div>
    <div class="breadcrumb-section">
        <div class="breadcrumb-container">
            <nav class="breadcrumb-nav" aria-label="Breadcrumb">
                <a href="index.html" class="breadcrumb-item">
                    <svg class="home-icon" fill="currentColor" viewBox="0 0 20 20">
                        <path
                            d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z" />
                    </svg>
                    Home
                </a>

                <span class="breadcrumb-separator">›</span>

                <a href="publication.html" class="breadcrumb-item">
                    Publications
                </a>
            </nav>
            <h1 class="page-title text-center">Publication</h1>
            <p class="page-description text-center">Discover our collection of published research papers, articles, and
                scholarly contributions. This page showcases our scientific work, including peer-reviewed publications,
                conference papers, reports, and ongoing research outputs.</p>
        </div>
    </div>
    <div class="decorative-shape-right"></div>
    <div class="publications-wrapper">
        <div class="publications-grid" id="publicationsGrid">
            <!-- Publications will be loaded dynamically here -->
            <div class="text-center py-5">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-2 text-muted">Loading research publications...</p>
            </div>
        </div>
        <div class="load-more-container">
            <button class="load-more-button" id="loadMoreBtn" style="display: none;">Load More Publications</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const ENDPOINTS = [
                'https://lab-backend-awux.onrender.com/publication',
                'https://lab-backend-awux.onrender.com/api/publication',
                'https://lab-backend-awux.onrender.com/publications',
                'https://lab-backend-awux.onrender.com/api/publications'
            ];

            const container = document.getElementById('publicationsGrid');
            const loadMoreBtn = document.getElementById('loadMoreBtn');
            let allPublications = [];
            let visibleCount = 5;

            async function loadPublications() {
                try {
                    let result = null;
                    let endpointUsed = '';

                    // Try endpoints until one works
                    for (const endpoint of ENDPOINTS) {
                        try {
                            const res = await fetch(endpoint);
                            if (res.ok) {
                                result = await res.json();
                                endpointUsed = endpoint;
                                break;
                            }
                        } catch (e) {
                            console.warn(`Failed to fetch from ${endpoint}`, e);
                        }
                    }

                    if (!result) {
                        throw new Error('All publication endpoints failed.');
                    }

                    console.log('Publications loaded from:', endpointUsed);

                    // Normalize data
                    if (Array.isArray(result)) {
                        allPublications = result;
                    } else if (result.data && Array.isArray(result.data)) {
                        allPublications = result.data;
                    } else if (result.publications && Array.isArray(result.publications)) {
                        allPublications = result.publications;
                    } else {
                        allPublications = [];
                    }

                    // Sort by year (descending) if year is available
                    allPublications.sort((a, b) => {
                        const yearA = parseInt(a.year) || 0;
                        const yearB = parseInt(b.year) || 0;
                        return yearB - yearA;
                    });

                    renderPublications();

                } catch (error) {
                    console.error('Error loading publications:', error);
                    container.innerHTML = `
                        <div class="text-center py-5 text-danger">
                            <i class="fas fa-exclamation-circle fa-2x mb-3"></i>
                            <p>Failed to load publications. Please try again later.</p>
                            <small class="text-muted">${error.message}</small>
                        </div>
                    `;
                }
            }

            function renderPublications() {
                if (allPublications.length === 0) {
                    container.innerHTML = `
                        <div class="text-center py-5 text-muted">
                            <p>No publications found.</p>
                        </div>
                    `;
                    loadMoreBtn.style.display = 'none';
                    return;
                }

                const displayItems = allPublications.slice(0, visibleCount);

                const html = displayItems.map((pub, index) => {
                    // Fallback values
                    const title = pub.title || 'Untitled Publication';

                    // Handle authors (array or string)
                    let authors = 'Unknown Authors';
                    if (Array.isArray(pub.authors)) {
                        authors = pub.authors.join(', ');
                    } else if (pub.authors) {
                        authors = pub.authors;
                    } else if (pub.author) {
                        authors = pub.author;
                    }

                    const journal = pub.journal || '';
                    const year = pub.year || '';
                    const doi = pub.doi ? `DOI: ${pub.doi}` : '';

                    // Link mapping matching the schema (webLink) + fallbacks
                    const link = pub.webLink || pub.link || pub.url || '#';
                    // PDF mapping (schema missing this, but good to keep support)
                    const pdf = pub.pdf || pub.pdfLink || '#';

                    // Construct journal info line
                    const journalInfo = [journal, year, doi].filter(Boolean).join('. ');

                    // Logic for hiding buttons if links are missing
                    const webBtn = (link && link !== '#')
                        ? `<a href="${link}" target="_blank" class="action-button-link">WEB</a>`
                        : '';
                    const pdfBtn = (pdf && pdf !== '#')
                        ? `<a href="${pdf}" target="_blank" class="action-button-link">PDF</a>`
                        : '';

                    const buttons = (webBtn || pdfBtn)
                        ? `<div class="publication-buttons-container">${webBtn}${pdfBtn}</div>`
                        : '';

                    return `
                        <div class="publication-item-card animate-on-scroll">
                            <div class="publication-number-badge">${index + 1}</div>
                            <h2 class="publication-title-heading">${title}</h2>
                            <p class="authors-list-text">${authors}</p>
                            <p class="journal-info-text">${journalInfo}</p>
                            ${buttons}
                        </div>
                    `;
                }).join('');

                container.innerHTML = html;

                // Handle Load More button
                if (visibleCount < allPublications.length) {
                    loadMoreBtn.style.display = 'inline-block';
                    loadMoreBtn.onclick = () => {
                        visibleCount += 5;
                        renderPublications();
                    };
                } else {
                    loadMoreBtn.style.display = 'none';
                }
            }

            // Start loading
            loadPublications();
        });
    </script>


    <div class="scroll-top" id="scrollTopBtn">
        <i class="fas fa-chevron-up"></i>
    </div>

    <footer class="footer-section">
        <div class="footer-content">
            <!-- Logo -->
            <div class="logo-container">
                <img class="logo-icon" src="assets/img/second logo 1.png">

                </img>
                <div class="logo-text">Rathi Research Group</div>
            </div>

            <!-- Navigation Menu -->
            <ul class="nav-menu">
                <li><a href="index.html">Home</a></li>
                <li><a href="research.html">Research</a></li>
                <li><a href="publication.html">Publications</a></li>
                <li><a href="team.html">Team</a></li>
                <li><a href="gallry.html">Gallery</a></li>
                <li><a href="contact.html">Contact</a></li>
            </ul>

            <!-- Email Icon -->
            <div class="email-icon">
                <a href="mailto:rathi@mit.edu" title="Email Us">
                    <i class="fas fa-envelope"></i>
                </a>
            </div>

            <!-- Bottom Section -->
            <div class="footer-bottom">
                <!-- MIT Logo -->
                <!-- Copyright -->
                <div class="copyright">
                    © 2025 <strong>Rathi Research Group</strong>. All rights reserved.
                    Proudly created by <strong><a href="https://arsharora.netlify.app/"
                            style="text-decoration: none; color: inherit;">Arsh Arora</strong></a>.
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script src="assets/js/Main.js"></script>
    <script>
        // ============================================
        // Sticky Navigation on Scroll
        // ============================================
        window.addEventListener('scroll', function () {
            const navigation = document.querySelector('.navigation');

            if (window.scrollY > 200) {
                navigation.classList.add('sticky');
                document.body.style.paddingTop = navigation.offsetHeight + 'px';
            } else {
                navigation.classList.remove('sticky');
                document.body.style.paddingTop = '0';
            }
        });

        // ============================================
        // Active Page Highlight
        // ============================================
        document.addEventListener('DOMContentLoaded', function () {
            const currentPage = window.location.pathname.split('/').pop();
            const navLinks = document.querySelectorAll('.nav-link');

            navLinks.forEach(link => {
                if (link.getAttribute('href') === currentPage) {
                    link.classList.add('active');
                }
            });
        });

        // ============================================
        // Close Mobile Menu on Link Click
        // ============================================
        document.addEventListener('DOMContentLoaded', function () {
            const navLinks = document.querySelectorAll('.nav-link');
            const navbarCollapse = document.querySelector('.navbar-collapse');

            navLinks.forEach(link => {
                link.addEventListener('click', function () {
                    if (navbarCollapse.classList.contains('show')) {
                        const bsCollapse = new bootstrap.Collapse(navbarCollapse, {
                            toggle: false
                        });
                        bsCollapse.hide();
                    }
                });
            });
        });

    </script>
</body>

</html>